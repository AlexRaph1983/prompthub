# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥—Å—á—ë—Ç–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö

## üéØ –¶–µ–ª—å

–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Å—á—ë—Ç –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:
- ‚ùå –£–±—Ä–∞—Ç—å –ø–æ–¥—Å—á—ë—Ç `prisma.prompt.count()` –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ `/api/categories`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à `Category.promptCount` –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã (single source of truth)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å `promptCount` –ø—Ä–∏ create/update/delete –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ —Å–º–µ–Ω–µ `categoryId`
- ‚úÖ –í–µ—Ä–Ω—É—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ä–æ–¥–∏—Ç–µ–ª—å/–¥–µ—Ç–∏) —Å –≥–æ—Ç–æ–≤—ã–º–∏ `promptCount`
- ‚úÖ –î–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ + –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–î–æ:**
- `/api/categories`: N –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î (–≥–¥–µ N = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å: `SELECT COUNT(*) FROM Prompt WHERE categoryId = ?`
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: O(N √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–ø—Ç–æ–≤)

**–ü–æ—Å–ª–µ:**
- `/api/categories`: 1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- –ß–∏—Ç–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `Category.promptCount`
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: O(1), –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–î–æ:**
- –°—á—ë—Ç—á–∏–∫–∏ –º–æ–≥–ª–∏ —Ä–∞—Å—Ö–æ–¥–∏—Ç—å—Å—è —Å —Ä–µ–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –¢—Ä–µ–±–æ–≤–∞–ª—Å—è —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ü–æ—Å–ª–µ:**
- –°—á—ë—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –ì–∞—Ä–∞–Ω—Ç–∏—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏: –ø—Ä–æ–º–ø—Ç —Å–æ–∑–¥–∞–Ω/–æ–±–Ω–æ–≤–ª—ë–Ω/—É–¥–∞–ª—ë–Ω ‚Üí —Å—á—ë—Ç—á–∏–∫ –∏–∑–º–µ–Ω—ë–Ω
- –ü—Ä–∏ —Å–±–æ–µ –≤—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. Sync-—Ö–µ–ª–ø–µ—Ä—ã –≤ `lib/prisma.ts`

–°–æ–∑–¥–∞–Ω—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏:

```typescript
// –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
export async function createPromptAndSync(data: Prisma.PromptCreateInput)

// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—á—ë—Ç—á–∏–∫–∏ (A ‚Üí B: A-1, B+1)
export async function updatePromptAndSync(
  where: Prisma.PromptWhereUniqueInput,
  data: Prisma.PromptUpdateInput
)

// –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
export async function deletePromptAndSync(where: Prisma.PromptWhereUniqueInput)
```

**–õ–æ–≥–∏–∫–∞:**
- `create` —Å `categoryId=X` ‚Üí `Category(X).promptCount += 1`
- `update` —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º `categoryId` –æ—Ç `A` –∫ `B`:
  - `Category(A).promptCount -= 1`
  - `Category(B).promptCount += 1`
- `delete` —Å `categoryId=X` ‚Üí `Category(X).promptCount -= 1`
- –ï—Å–ª–∏ `categoryId = null` ‚Üí —Å—á—ë—Ç—á–∏–∫ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ (–≤ `$transaction`)

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API `/api/categories`

**–§–∞–π–ª:** `app/api/categories/route.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ë–î –≤–º–µ—Å—Ç–æ N –ø–æ–¥—Å—á—ë—Ç–æ–≤
- –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ä–æ–¥–∏—Ç–µ–ª–∏ + –¥–µ—Ç–∏) —Å `promptCount` –∏–∑ –∫—ç—à–∞
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–æ–Ω–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ DEV (env `CATEGORIES_VALIDATE_COUNTS=true`)

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:**
```json
[
  {
    "id": "cat-id-1",
    "slug": "category-slug",
    "name": "Category Name",
    "nameRu": "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
    "nameEn": "Category Name",
    "promptCount": 42,
    "children": [
      {
        "id": "subcat-id",
        "slug": "subcategory-slug",
        "promptCount": 15,
        ...
      }
    ]
  }
]
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

**–§–∞–π–ª:** `app/[locale]/(public)/CategoryNavServer.tsx`

- –ß–∏—Ç–∞–µ—Ç –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ API
- –ù–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ `children: []`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 2 —É—Ä–æ–≤–Ω–µ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ (—Ä–æ–¥–∏—Ç–µ–ª–∏ + –¥–µ—Ç–∏)

### 4. –ó–∞–º–µ–Ω–∞ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ sync-—Ö–µ–ª–ø–µ—Ä—ã

–ó–∞–º–µ–Ω–µ–Ω—ã –≤–æ –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö:

**–§–∞–π–ª—ã:**
- `app/api/prompts/route.ts` ‚Üí `createPromptAndSync`
- `app/api/prompts/[id]/route.ts` ‚Üí `updatePromptAndSync`, `deletePromptAndSync`
- `app/api/admin/prompts/route.ts` ‚Üí `deletePromptAndSync`
- `app/api/prompts/bulk/route.ts` ‚Üí `createPromptAndSync`

**–£–¥–∞–ª–µ–Ω—ã:**
- –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `updateCounters()` –∏–∑ API –ø—Ä–æ–º–ø—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—è `category` (slug) –≤–º–µ—Å—Ç–æ `categoryId`

### 5. –ê–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞

**–§–∞–π–ª:** `app/api/admin/recount-categories/route.ts`

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/admin/recount-categories`

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ü—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `authFromRequest`)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –û–±–Ω—É–ª—è–µ—Ç –≤—Å–µ `Category.promptCount = 0`
2. –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –ø–æ `categoryId` —á–µ—Ä–µ–∑ `groupBy` (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏ –±–∞—Ç—á–µ–º –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
curl -X POST https://prompt-hub.site/api/admin/recount-categories \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "Category prompt counts recalculated successfully",
  "stats": {
    "categoriesReset": 45,
    "categoriesUpdated": 38,
    "topCategories": [...]
  },
  "timestamp": "2025-01-15T12:34:56.789Z"
}
```

### 6. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç

**–§–∞–π–ª:** `scripts/update-category-counts.js`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏
node scripts/update-category-counts.js update

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
node scripts/update-category-counts.js stats

# –û–±–Ω–æ–≤–∏—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
node scripts/update-category-counts.js full
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `groupBy` –≤–º–µ—Å—Ç–æ —Ü–∏–∫–ª–∞ —Å `count` –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ë–∞—Ç—á-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø-10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ç–µ–≥–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit-—Ç–µ—Å—Ç—ã

**–§–∞–π–ª:** `__tests__/lib/prisma-sync.test.ts`

–ü–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π ‚Üí —Å—á—ë—Ç—á–∏–∫ +1
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí —Å—á—ë—Ç—á–∏–∫ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å–æ —Å–º–µ–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (A ‚Üí B) ‚Üí A-1, B+1
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –±–µ–∑ —Å–º–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí —Å—á—ë—Ç—á–∏–∫ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É –ø—Ä–æ–º–ø—Ç–∞ (A ‚Üí null) ‚Üí A-1
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–º–ø—Ç—É (null ‚Üí A) ‚Üí A+1
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ ‚Üí —Å—á—ë—Ç—á–∏–∫ -1
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å: –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

**–ó–∞–ø—É—Å–∫:**
```bash
npm run test __tests__/lib/prisma-sync.test.ts
```

### E2E —Ç–µ—Å—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è Playwright:
1. –û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `promptCount` –≤ –ª–µ–≤–æ–º –º–µ–Ω—é
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–ø—Ç –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ C ‚Üí –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ –ø–æ—Å–ª–µ refresh
3. –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–º–ø—Ç–∞ C1 ‚Üí C2 ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á—ë—Ç—á–∏–∫–∏
4. –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç ‚Üí —Å—á—ë—Ç—á–∏–∫ -1
5. –í—ã–∑–≤–∞—Ç—å `/api/admin/recount-categories` ‚Üí —Å—á—ë—Ç—á–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## üöÄ –î–µ–ø–ª–æ–π

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ç –ª–∏ –æ—à–∏–±–æ–∫ TypeScript
npm run type-check

# –ó–∞–ø—É—Å—Ç–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
npm run test

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä
npm run lint
```

### 2. –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω–∞ –ø—Ä–æ–¥ –Ω—É–∂–Ω–æ **–æ–¥–∏–Ω —Ä–∞–∑** –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å—á—ë—Ç—á–∏–∫–∏:

**–í–∞—Ä–∏–∞–Ω—Ç A:** –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç
```bash
curl -X POST https://prompt-hub.site/api/admin/recount-categories \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

**–í–∞—Ä–∏–∞–Ω—Ç B:** –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```bash
ssh root@YOUR_SERVER_IP_HERE
cd /root/prompthub
node scripts/update-category-counts.js update
```

### 3. Cron –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—á—ë—Ç—á–∏–∫–æ–≤:

```bash
# –ö–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00
0 3 * * * cd /root/prompthub && node scripts/update-category-counts.js update >> /var/log/category-recount.log 2>&1
```

### 4. –ö–æ–º–∞–Ω–¥—ã –¥–µ–ø–ª–æ—è

```bash
cd /root/prompthub && \
git fetch origin && \
git reset --hard origin/main && \
bash scripts/deploy.sh
```

**–í–∞–∂–Ω–æ:** –ù–ï –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã migrate/seed –Ω–∞ –ø—Ä–æ–¥–µ (–æ–Ω–∏ –≤–∞–ª—è—Ç –¥–µ–ø–ª–æ–π)!

## üìù Acceptance Criteria

‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** `/api/categories` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ä–µ–≤–æ —Å `promptCount` –∏–∑ –∫—ç—à–∞, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ O(1)

‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ü—Ä–∏ create/update/delete –ø—Ä–æ–º–ø—Ç–∞ —Å—á—ë—Ç—á–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –∞—Ç–æ–º–∞—Ä–Ω–æ

‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å:** –õ–µ–≤–æ–µ –º–µ–Ω—é –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ —Ä—É—á–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

‚úÖ **–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞:** –£–¥–∞–ª–µ–Ω—ã —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ `updateCounters()` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `category` (slug)

‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ê–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç –∑–∞—â–∏—â—ë–Ω –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤

‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–∫—Ä—ã—Ç–æ unit-—Ç–µ—Å—Ç–∞–º–∏

‚úÖ **–ò–µ—Ä–∞—Ä—Ö–∏—è:** API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –¥–µ—Ç—å–º–∏

## üîç –î–µ–±–∞–≥–≥–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π —Å—á—ë—Ç—á–∏–∫–æ–≤

**DEV —Ä–µ–∂–∏–º:**
```bash
# –í .env.local
CATEGORIES_VALIDATE_COUNTS=true
```

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `/api/categories` –≤ –ª–æ–≥–∞—Ö –±—É–¥—É—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö:
```
[CATEGORIES_VALIDATE] Mismatch for category-slug: cached=42, actual=40
```

**Production:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ä—É—á–Ω—É—é
node scripts/update-category-counts.js stats
```

### –†—É—á–Ω–æ–π –ø–µ—Ä–µ—Å—á—ë—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@YOUR_SERVER_IP_HERE
cd /root/prompthub
node scripts/update-category-counts.js update
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –§–∏—á–∞-—Ñ–ª–∞–≥–∏

- `CATEGORIES_VALIDATE_COUNTS=true` ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ DEV (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç)

### Nice to have (–±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è)

1. –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ `promptCount` —Ä–æ–¥–∏—Ç–µ–ª—è –∫–∞–∫ —Å—É–º–º–∞ –¥–µ—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞ UI)
2. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Ñ–æ–Ω–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ production —Å –∞–ª–µ—Ä—Ç–∞–º–∏
3. –ú–µ—Ç—Ä–∏–∫–∏ –≤ monitoring (Prometheus/Grafana) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π
4. Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö

## üéâ –ò—Ç–æ–≥–æ

**–ë—ã–ª–æ:**
- N –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î –Ω–∞ –∫–∞–∂–¥—ã–π `/api/categories`
- –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—á—ë—Ç—á–∏–∫–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–°—Ç–∞–ª–æ:**
- 1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- –ü–æ–ª–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ó–∞—â–∏—â—ë–Ω–Ω—ã–π –∞–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞
- –ü–æ–∫—Ä—ã—Ç–æ —Ç–µ—Å—Ç–∞–º–∏

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ~10-100x —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

**–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** 100% –±–ª–∞–≥–æ–¥–∞—Ä—è –∞—Ç–æ–º–∞—Ä–Ω—ã–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º

