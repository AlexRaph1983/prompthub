# Руководство по тестированию админ-панели

## Быстрый старт

### 1. Создание админского пользователя

```bash
# Сначала войдите на сайт через Google OAuth
# Затем создайте админского пользователя:
node scripts/create-admin.js your-email@gmail.com super_admin
```

### 2. Альтернативный способ (через переменную окружения)

```bash
# В .env файле добавьте:
ADMIN_EMAIL=your-email@gmail.com

# Перезапустите сервер
npm run dev
```

## Тестирование функций

### Дашборд (`/admin`)

**Что тестировать:**
- [ ] Отображение общей статистики
- [ ] Графики роста пользователей
- [ ] Топ промпты
- [ ] Топ поисковые запросы
- [ ] Кнопка "Обновить" работает
- [ ] Время последнего обновления отображается

**Ожидаемый результат:**
- Все статистические карточки заполнены данными
- Графики отображаются корректно
- Нет ошибок в консоли

### Управление промптами (`/admin/prompts`)

**Что тестировать:**
- [ ] Загрузка списка промптов
- [ ] Поиск по названию/описанию/автору
- [ ] Фильтрация по категориям
- [ ] Сортировка (дата, просмотры, рейтинг)
- [ ] Выбор отдельных промптов
- [ ] Выбор всех промптов на странице
- [ ] Удаление одного промпта
- [ ] Массовое удаление промптов
- [ ] Пагинация
- [ ] Просмотр деталей промпта
- [ ] Переход к публичной странице промпта

**Ожидаемый результат:**
- Все фильтры и поиск работают
- Удаление промптов с подтверждением
- Корректная пагинация
- Информативные сообщения об ошибках

### Аналитика поиска (`/admin/search-analytics`)

**Что тестировать:**
- [ ] Отображение общей статистики поиска
- [ ] Переключение периодов (7/30/90 дней)
- [ ] График активности по дням
- [ ] Топ поисковые запросы
- [ ] Запросы без результатов
- [ ] Таблица последних запросов
- [ ] Экспорт данных в CSV
- [ ] Кнопка "Обновить"

**Ожидаемый результат:**
- Все данные загружаются корректно
- Фильтры по периоду работают
- CSV экспорт скачивается
- График отображается правильно

## Тестирование отслеживания поисковых запросов

### Генерация тестовых данных

1. Перейдите на главную страницу сайта
2. Выполните несколько поисковых запросов:
   - "AI prompt" (должен найти результаты)
   - "машинное обучение" (может найти результаты)
   - "несуществующий запрос xyz123" (не найдет результатов)
3. Кликните на некоторые найденные промпты
4. Подождите 30 секунд для обработки данных
5. Перейдите в админ-панель и проверьте аналитику

### Проверка данных

```bash
# Посмотрите статистику через скрипт:
node scripts/search-stats.js 1

# Проверьте базу данных:
npx prisma studio
# Откройте таблицу SearchQuery
```

## Тестирование безопасности

### Проверка доступа без авторизации

1. Выйдите из аккаунта
2. Попробуйте зайти на `/admin`
3. **Ожидается:** Редирект на страницу входа

### Проверка доступа с неадминским аккаунтом

1. Войдите аккаунтом, который НЕ является админом
2. Попробуйте зайти на `/admin`
3. **Ожидается:** Редирект на страницу входа

### Проверка API без авторизации

```bash
# Должны вернуть 401 Unauthorized:
curl http://localhost:3000/api/admin/dashboard
curl http://localhost:3000/api/admin/prompts
curl http://localhost:3000/api/admin/search-analytics
```

## Тестирование производительности

### Большие объемы данных

1. Создайте тестовые поисковые запросы:
```bash
# Выполните много поисков на сайте или создайте скрипт
for i in {1..100}; do
  curl -X POST http://localhost:3000/api/search-tracking \
    -H "Content-Type: application/json" \
    -d "{\"query\":\"test query $i\",\"resultsCount\":5}"
done
```

2. Проверьте, что админ-панель работает быстро с большим количеством данных

### Проверка кэширования

1. Откройте дашборд
2. Обновите страницу несколько раз быстро
3. **Ожидается:** Быстрая загрузка благодаря кэшированию

## Проверка мобильной версии

1. Откройте админ-панель на мобильном устройстве
2. Проверьте адаптивность всех страниц
3. Убедитесь, что навигация работает на мобильных

## Логи и мониторинг

### Проверка логов

```bash
# Проверьте логи сервера на предмет ошибок
# При удалении промптов должны появляться записи:
# [ADMIN] Prompt deleted by admin@example.com: Title (ID: xxx) by author@example.com
```

### Мониторинг ошибок

1. Откройте DevTools в браузере
2. Перейдите на вкладку Console
3. Выполните все действия в админ-панели
4. **Ожидается:** Отсутствие ошибок JavaScript

## Восстановление после тестирования

### Восстановление удаленных промптов

Если случайно удалили важные промпты:

1. Остановите сервер
2. Восстановите базу данных из бэкапа
3. Или используйте `git` для отката изменений в `dev.db`

### Очистка тестовых данных

```bash
# Очистка поисковых запросов:
npx prisma studio
# Удалите записи из таблицы SearchQuery

# Или через SQL:
sqlite3 prisma/dev.db "DELETE FROM SearchQuery WHERE query LIKE 'test%';"
```

## Отчет о тестировании

После тестирования создайте отчет:

- [ ] Все основные функции работают
- [ ] Безопасность обеспечена
- [ ] Производительность приемлемая
- [ ] Мобильная версия адаптивна
- [ ] Нет критических ошибок
- [ ] Логирование работает
- [ ] Данные отслеживания корректны

## Известные ограничения

1. **Prisma Generate Error**: Если возникает ошибка EPERM при `prisma generate`, перезапустите IDE и попробуйте снова
2. **Кэширование**: Некоторые данные кэшируются на 5 минут для производительности
3. **SQLite**: В продакшене рекомендуется использовать PostgreSQL для лучшей производительности
4. **Файловые разрешения**: На Windows могут возникать проблемы с правами доступа к файлам
