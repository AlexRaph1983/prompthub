#!/bin/bash

echo "๐ ะะะะะะะะฃะกะ ะกะะะะะะ ะะ ะะะะะะะจะะะ"
echo "=================================="

# ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd /root/prompthub

echo "๐ฅ ะะพะปััะฐะตะผ ะฟะพัะปะตะดะฝะธะต ะธะทะผะตะฝะตะฝะธั..."
git fetch origin
git reset --hard origin/main

echo "๐ ะััะฐะฝะฐะฒะปะธะฒะฐะตะผ ัะตะบััะธะน ัะตัะฒะตั..."
pm2 stop all
pm2 delete all

echo "๐งน ะัะธัะฐะตะผ ะบััะธ ะธ ะทะฐะฒะธัะธะผะพััะธ..."
rm -rf node_modules
rm -rf .next

echo "๐ฆ ะฃััะฐะฝะฐะฒะปะธะฒะฐะตะผ ะทะฐะฒะธัะธะผะพััะธ..."
npm install

echo "๐จ ะะตัะตัะพะฑะธัะฐะตะผ ะฟัะพะตะบั..."
npm run build

echo "๐ ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั..."
pm2 start ecosystem.config.js

echo "๐ ะัะพะฒะตััะตะผ ััะฐััั..."
pm2 status

echo "โณ ะะดะตะผ 10 ัะตะบัะฝะด ะดะปั ะทะฐะฟััะบะฐ..."
sleep 10

echo "๐ ะัะพะฒะตััะตะผ API endpoints..."
curl -s https://prompt-hub.site/api/health | jq .
curl -s https://prompt-hub.site/api/stats | jq .

echo "โ ะะตัะตะทะฐะฟััะบ ะทะฐะฒะตััะตะฝ!"
echo "๐ง ะัะพะฒะตัััะต ะปะพะณะธ: pm2 logs"
