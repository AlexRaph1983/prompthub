const { PrismaClient } = require('@prisma/client');
const CONTENT_STRATEGY = require('./content-strategy.js');
// Определяем константы напрямую
const PROMPT_MODELS = [
  "GPT-5", "OpenAI Sora", "Claude Opus 4.1", "Gemini 2.5 Pro", "Gemini 2.5 Flash",
  "Gemini 2.5 Flash-Lite", "Google Veo 3", "Llama 3.1", "Mistral Large", "DeepSeek",
  "Suno", "AIVA", "Runway Gen-2", "Яндекс Алиса"
];

const PROMPT_CATEGORIES = [
  "Chat", "Code", "SEO", "Design", "Legal", "Education", "Image", "Video", "Music",
  "Audio", "3D", "Animation", "Business", "Marketing", "Writing", "Translation",
  "Research", "Analysis", "Creative", "Productivity", "Gaming", "Health", "Finance", "Cooking"
];

const prisma = new PrismaClient();

// Получить ID категории по slug
async function getCategoryId(slug) {
  const category = await prisma.category.findUnique({
    where: { slug },
    select: { id: true }
  });
  if (!category) {
    throw new Error(`Категория ${slug} не найдена`);
  }
  return category.id;
}

// Получить случайного автора (не promptmaster)
async function getRandomAuthor() {
  const authors = await prisma.user.findMany({
    where: {
      prompts: {
        some: {} // У пользователя есть промпты
      },
      NOT: {
        email: {
          contains: 'promptmaster'
        }
      }
    },
    select: { id: true },
    take: 10
  });

  if (authors.length === 0) {
    // Если нет других авторов, используем первого попавшегося
    const anyAuthor = await prisma.user.findFirst({
      select: { id: true }
    });
    return anyAuthor?.id || 'default-author-id';
  }

  return authors[Math.floor(Math.random() * authors.length)].id;
}

// Выбрать модель для категории
function selectModelForCategory(category) {
  const availableModels = CONTENT_STRATEGY.categoryModelMapping[category];
  if (!availableModels) {
    return 'GPT-5'; // fallback
  }
  return availableModels[Math.floor(Math.random() * availableModels.length)];
}

// Маппинг полных названий категорий к их slugs для генераторов
const categorySlugMapping = {
  'Marketing & Writing': 'marketing-writing',
  'Video': 'video',
  'Music': 'music',
  'Business': 'business',
  'Creative': 'creative',
  'Design': 'design',
  'Education': 'education',
  'Chat': 'chat',
  'Code': 'code',
  'Analysis': 'analysis',
  'Productivity': 'productivity',
  'research': 'research',
  'image': 'image',
  'audio': 'audio',
  'photo-editing': 'photo-editing',
  'photography': 'photography',
  'legal': 'legal',
  'health': 'health',
  'finance': 'finance',
  'seo': 'seo',
  'animation': 'animation',
  'gaming': 'gaming',
  'cooking': 'cooking',
  '3d': '3d'
};

// Генераторы промптов по категориям (используем slugs)
const promptGenerators = {
  'marketing-writing': {
    templates: [
      {
        title: "Промпт для создания продающего текста о {продукт}",
        description: "Создает убедительный маркетинговый текст, который подчеркивает преимущества продукта и мотивирует к покупке.",
        prompt: `Ты — профессиональный копирайтер и маркетолог. Твоя задача — создать продающий текст о продукте.

КОНТЕКСТ ПРОДУКТА:
- Название: {продукт}
- Целевая аудитория: {аудитория}
- Ключевые преимущества: {преимущества}
- Уникальное торговое предложение: {утп}

СТРУКТУРА ПРОДАЮЩЕГО ТЕКСТА:
1. ЗАГАЛОВОК: Привлекательный, с обещанием пользы
2. ВВЕДЕНИЕ: Погружение в проблему клиента
3. ОСНОВНАЯ ЧАСТЬ: Подробное описание преимуществ и решений
4. ДОКАЗАТЕЛЬСТВА: Факты, примеры, отзывы
5. ПРИЗЫВ К ДЕЙСТВИЮ: Четкие инструкции для заказа

СТИЛЬ: Профессиональный, убедительный, ориентированный на результат.
Используй эмоциональные триггеры: страх потери, желание улучшения, социальное доказательство.

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Готовый продающий текст длиной 800-1200 символов.`,
        tags: "маркетинг,продажи,копирайтинг,реклама"
      },
      {
        title: "SEO-оптимизированный пост для блога о {тема}",
        description: "Создает SEO-дружественный пост для блога с правильной структурой и ключевыми словами.",
        prompt: `Ты — SEO-специалист и контент-маркетолог. Создай оптимизированный пост для блога.

ОСНОВНЫЕ ПАРАМЕТРЫ:
- Основное ключевое слово: {ключевое_слово}
- Дополнительные ключевые слова: {доп_ключи}
- Целевая аудитория: {аудитория}
- Тональность: {тональность}

СТРУКТУРА ПОСТА:
1. ЗАГОЛОВОК H1: С основным ключевым словом
2. ВВЕДЕНИЕ: 150-200 слов, включает основное ключевое слово
3. ОСНОВНОЙ КОНТЕНТ: 3-4 раздела H2 с подзаголовками
4. ЗАКЛЮЧЕНИЕ: Выводы и призыв к действию
5. МЕТА-ОПИСАНИЕ: 150-160 символов

SEO-ТРЕБОВАНИЯ:
- Плотность ключевых слов: 1-2%
- Длина поста: 1500-2500 слов
- Внутренние ссылки: минимум 2-3
- Внешние ссылки: 1-2 (на авторитетные источники)
- Изображения: ALT-тексты с ключевыми словами

ФОРМАТ ВЫВОДА: Полный HTML-код поста с правильной разметкой.`,
        tags: "SEO,блог,контент-маркетинг,оптимизация"
      },
      {
        title: "Скрипт для продающего видео о {услуга}",
        description: "Создает полный скрипт для продающего видео с правильной структурой и психологическими триггерами.",
        prompt: `Ты — сценарист продающих видео и психолог продаж. Создай скрипт для видео-продажи.

ПРОДУКТ/УСЛУГА:
- Название: {услуга}
- Стоимость: {цена}
- Результат для клиента: {результат}
- Гарантии: {гарантии}

СТРУКТУРА СКРИПТА:
1. ХУК (0:00-0:30): Захватывающее начало, проблема клиента
2. ПРОБЛЕМА (0:30-2:00): Детальное описание боли клиента
3. РЕШЕНИЕ (2:00-4:00): Как продукт решает проблему
4. ДОКАЗАТЕЛЬСТВА (4:00-6:00): Факты, примеры, отзывы
5. ПРЕИМУЩЕСТВА (6:00-8:00): Почему выбрать именно этот продукт
6. ВОЗРАЖЕНИЯ (8:00-9:00): Ответы на возможные сомнения
7. СПЕЦИАЛЬНОЕ ПРЕДЛОЖЕНИЕ (9:00-10:00): Акция, бонусы
8. ПРИЗЫВ К ДЕЙСТВИЮ (10:00-10:30): Четкие инструкции

СТИЛЬ: Разговорный, доверительный, эмоциональный.
ДЛИНА: 800-1000 слов для 10-12 минут видео.

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный скрипт с таймингами и указаниями для оператора.`,
        tags: "видео,продажи,скрипт,маркетинг"
      }
    ]
  },

  'video': {
    templates: [
      {
        title: "Промпт для создания вирусного короткого видео о {тема}",
        description: "Создает сценарий для короткого видео, которое привлекает внимание и получает много просмотров.",
        prompt: `Ты — эксперт по вирусному контенту и коротким видео. Создай сценарий для TikTok/Reels видео.

ТЕМА ВИДЕО: {тема}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ПЛАТФОРМА: {платформа}

СТРУКТУРА ВИРУСНОГО ВИДЕО:
1. ХУК (первые 3 секунды): Шокирующий факт/вопрос/визуал
2. ПРОБЛЕМА (3-10 сек): Что беспокоит зрителя
3. РЕШЕНИЕ (10-25 сек): Простой совет/метод
4. ДОКАЗАТЕЛЬСТВО (25-35 сек): Почему это работает
5. ПРИЗЫВ К ДЕЙСТВИЮ (35-45 сек): Что делать дальше

ВИЗУАЛЬНЫЕ ЭЛЕМЕНТЫ:
- Текст на экране: Крупный, читаемый, эмоциональный
- Музыка: Популярный трек или трендовая музыка
- Эффекты: Переходы, зум, цветокоррекция
- Темп: Динамичный, без пауз

ХЭШТЕГИ: 5-8 релевантных хэштегов
ОПИСАНИЕ: Призывное описание 50-100 символов

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный сценарий с таймингами и визуальными указаниями.`,
        tags: "видео,TikTok,вирусный,контент"
      },
      {
        title: "Сценарий для образовательного видео о {навык}",
        description: "Создает подробный сценарий образовательного видео с практическими примерами и упражнениями.",
        prompt: `Ты — преподаватель и создатель образовательного контента. Создай сценарий обучающего видео.

НАВЫК ДЛЯ ОБУЧЕНИЯ: {навык}
УРОВЕНЬ СЛУШАТЕЛЕЙ: {уровень}
ПРОДОЛЖИТЕЛЬНОСТЬ: {длительность} минут

СТРУКТУРА ОБРАЗОВАТЕЛЬНОГО ВИДЕО:
1. ВВЕДЕНИЕ (10% времени):
   - Приветствие и цель видео
   - Что зрители узнают
   - Почему это важно

2. ТЕОРЕТИЧЕСКАЯ ЧАСТЬ (30% времени):
   - Основные понятия
   - Принципы и правила
   - Визуальные примеры

3. ПРАКТИЧЕСКАЯ ЧАСТЬ (50% времени):
   - Пошаговое руководство
   - Демонстрация на примерах
   - Распространенные ошибки

4. ЗАКЛЮЧЕНИЕ (10% времени):
   - Краткое резюме
   - Следующие шаги
   - Призыв к действию

ВИЗУАЛЬНЫЕ ЭЛЕМЕНТЫ:
- Слайды с ключевыми моментами
- Демонстрация на экране
- Графика и анимации
- Субтитры для всех объяснений

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Детальный сценарий с таймингами и методическими указаниями.`,
        tags: "образование,обучение,видео,навыки"
      }
    ]
  },

  'music': {
    templates: [
      {
        title: "Промпт для создания музыки в стиле {жанр} с настроением {настроение}",
        description: "Создает детальное описание для генерации музыки с конкретными параметрами и эмоциональным настроем.",
        prompt: `Ты — музыкальный продюсер и композитор. Создай детальное описание для генерации музыки.

МУЗЫКАЛЬНЫЕ ПАРАМЕТРЫ:
- Жанр: {жанр}
- Настроение/атмосфера: {настроение}
- Темп (BPM): {темп}
- Длительность: {длительность} минут
- Инструменты: {инструменты}

СТРУКТУРА КОМПОЗИЦИИ:
1. ВСТУПЛЕНИЕ (0:00-0:30): Установка атмосферы
2. ОСНОВНАЯ ТЕМА (0:30-2:00): Развитие мелодии
3. КУЛЬМИНАЦИЯ (2:00-3:00): Эмоциональный пик
4. РАЗРЕШЕНИЕ (3:00-4:00): Завершение и спад

МУЗЫКАЛЬНЫЕ ЭЛЕМЕНТЫ:
- Мелодия: Основная тема и вариации
- Гармония: Аккорды и прогрессии
- Ритм: Паттерны и ударные
- Текстура: Слои и аранжировка
- Динамика: Изменения громкости

ЭМОЦИОНАЛЬНЫЙ ВОЗДЕЙСТВИЕ:
- Целевая эмоция: {эмоция}
- Психологический эффект: {эффект}
- Ассоциации: {ассоциации}

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Подробное техническое задание для генерации музыки.`,
        tags: "музыка,композиция,продакшн,генерация"
      },
      {
        title: "Промпт для создания саундтрека к видео {тип_видео}",
        description: "Создает саундтрек, идеально подходящий под тип видео с учетом ритма и эмоционального воздействия.",
        prompt: `Ты — композитор саундтреков и аудиодизайнер. Создай описание музыки для видео.

ТИП ВИДЕО: {тип_видео}
НАЗНАЧЕНИЕ: {назначение}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ДЛИТЕЛЬНОСТЬ ВИДЕО: {длительность}

АНАЛИЗ ВИДЕО:
- Ритм монтажа: {ритм}
- Эмоциональные переходы: {эмоции}
- Ключевые моменты: {моменты}
- Общий тон: {тон}

МУЗЫКАЛЬНЫЕ ПАРАМЕТРЫ:
1. ВСТУПИТЕЛЬНАЯ ТЕМА (0-20 сек): Установка атмосферы
2. ОСНОВНАЯ ТЕМА (20-70 сек): Сопровождение основного контента
3. ЭМОЦИОНАЛЬНЫЙ ПИК (70-90 сек): Кульминационные моменты
4. ЗАВЕРШЕНИЕ (90-100 сек): Финальные аккорды

ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ:
- Формат: WAV/MP3
- Качество: 320kbps
- Каналы: Стерео
- Fade in/out: Плавные переходы
- Синхронизация: Точное совпадение с видео

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Техническое задание для композитора с точными спецификациями.`,
        tags: "саундтрек,видео,аудио,композиция"
      }
    ]
  },

  'business': {
    templates: [
      {
        title: "Бизнес-план для стартапа в сфере {отрасль}",
        description: "Создает детальный бизнес-план с анализом рынка, финансовыми расчетами и стратегией развития.",
        prompt: `Ты — бизнес-консультант и инвестор. Создай подробный бизнес-план для стартапа.

ОТРАСЛЬ: {отрасль}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
КОНКУРЕНТНЫЕ ПРЕИМУЩЕСТВА: {преимущества}
СТАРТОВЫЙ КАПИТАЛ: {капитал}

СТРУКТУРА БИЗНЕС-ПЛАНА:

1. ИСПОЛНИТЕЛЬНОЕ РЕЗЮМЕ (2-3 страницы)
   - Описание бизнеса
   - Ключевые показатели
   - Финансовые потребности

2. ОПИСАНИЕ КОМПАНИИ (3-4 страницы)
   - Миссия и видение
   - Юридическая форма
   - Расположение и структура

3. АНАЛИЗ РЫНКА (5-7 страниц)
   - Общий размер рынка
   - Целевая аудитория
   - Конкурентный анализ
   - SWOT-анализ

4. ПРОДУКТЫ И УСЛУГИ (4-5 страниц)
   - Описание предложения
   - Ценообразование
   - Разработка и производство

5. МАРКЕТИНГ И ПРОДАЖИ (5-6 страниц)
   - Маркетинговая стратегия
   - Каналы продаж
   - Продвижение и реклама

6. ОПЕРАЦИОННЫЙ ПЛАН (4-5 страниц)
   - Производственный процесс
   - Поставщики и партнеры
   - Технологии и оборудование

7. УПРАВЛЕНЧЕСКАЯ КОМАНДА (3-4 страницы)
   - Ключевые сотрудники
   - Организационная структура
   - Заработная плата

8. ФИНАНСОВЫЙ ПЛАН (8-10 страниц)
   - Прогноз доходов и расходов
   - Точка безубыточности
   - Потребность в финансировании

ФОРМАТ: Профессиональный документ с таблицами, графиками и расчетами.`,
        tags: "бизнес,стартап,планирование,финансы"
      },
      {
        title: "Стратегия развития компании на {период} лет",
        description: "Создает долгосрочную стратегию развития с конкретными целями, KPI и планом реализации.",
        prompt: `Ты — стратегический консультант и CEO. Разработай стратегию развития компании.

КОМПАНИЯ:
- Отрасль: {отрасль}
- Текущий размер: {размер}
- Ключевые продукты: {продукты}
- Рынок присутствия: {рынок}

СТРАТЕГИЧЕСКИЕ НАПРАВЛЕНИЯ:

1. ВИДЕНИЕ И МИССИЯ (обновление)
   - Долгосрочное видение ({период} лет)
   - Миссия и ценности
   - Стратегические цели

2. АНАЛИЗ ОКРУЖЕНИЯ
   - Макроэкономические тенденции
   - Изменения в отрасли
   - Поведение потребителей
   - Конкурентная среда

3. СТРАТЕГИЧЕСКИЕ ИНИЦИАТИВЫ
   - Рост бизнеса
   - Развитие продуктов
   - Международная экспансия
   - Цифровая трансформация

4. ОПЕРАЦИОННЫЕ ПРИОРИТЕТЫ
   - Ключевые проекты
   - Ресурсное обеспечение
   - Организационные изменения

5. ФИНАНСОВАЯ СТРАТЕГИЯ
   - Цели роста выручки
   - Прибыльность
   - Инвестиционные приоритеты

6. СИСТЕМА УПРАВЛЕНИЯ
   - KPI и метрики
   - Система мотивации
   - Мониторинг исполнения

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Стратегический план с конкретными действиями и сроками.`,
        tags: "стратегия,развитие,планирование,управление"
      }
    ]
  },

  'creative': {
    templates: [
      {
        title: "Идеи для креативного проекта в стиле {стиль}",
        description: "Генерирует креативные идеи и концепции для творческих проектов с детальным описанием реализации.",
        prompt: `Ты — креативный директор и арт-директор. Создай концепцию креативного проекта.

СТИЛЬ ПРОЕКТА: {стиль}
ТЕМАТИКА: {тематика}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ФОРМАТ: {формат}

СТРУКТУРА КОНЦЕПЦИИ:

1. ОСНОВНАЯ ИДЕЯ
   - Центральная концепция
   - Эмоциональный посыл
   - Уникальное предложение

2. ВИЗУАЛЬНЫЙ СТИЛЬ
   - Цветовая палитра
   - Типографика
   - Графические элементы
   - Образы и метафоры

3. НАРАТИВ И СЮЖЕТ
   - Основная история
   - Персонажи и характеры
   - Конфликт и разрешение
   - Эмоциональная арка

4. ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ
   - Необходимые инструменты
   - Техники и методы
   - Производственный процесс
   - Бюджет и ресурсы

5. МАРКЕТИНГ И ПРОДВИЖЕНИЕ
   - Каналы коммуникации
   - Стратегия распространения
   - Целевые площадки

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полная креативная концепция с moodboard и планом реализации.`,
        tags: "креатив,дизайн,концепция,арт"
      },
      {
        title: "Генератор идей для контент-стратегии {платформа}",
        description: "Создает комплексную стратегию контента с идеями постов, темами и планом публикаций.",
        prompt: `Ты — контент-стратег и SMM-специалист. Разработай контент-стратегию.

ПЛАТФОРМА: {платформа}
БРЕНД/НИША: {ниша}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ПЕРИОД ПЛАНИРОВАНИЯ: {период}

СТРАТЕГИЧЕСКИЕ ЭЛЕМЕНТЫ:

1. АНАЛИЗ АУДИТОРИИ
   - Портреты ЦА
   - Интересы и боли
   - Поведенческие паттерны

2. КОНТЕНТ-СТОЛБЫ
   - Основные темы
   - Уникальный голос бренда
   - Брендовые ценности

3. КОНТЕНТ-МИКС
   - Форматы контента (80%)
   - Промо-посты (20%)
   - Stories/Reels (30%)

4. КОНТЕНТ-КАЛЕНДАРЬ
   - Тематические недели
   - Специальные мероприятия
   - Сезонный контент

5. ПРОДВИЖЕНИЕ И АНАЛИТИКА
   - Хэштеги и геолокации
   - Взаимодействие с аудиторией
   - Метрики успеха

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Готовый план контента на месяц с идеями постов.`,
        tags: "контент,SMM,стратегия,продвижение"
      }
    ]
  },

  'design': {
    templates: [
      {
        title: "Дизайн-концепция для бренда {тип_бренда}",
        description: "Создает полную дизайн-концепцию бренда с логотипом, цветами, типографикой и фирменным стилем.",
        prompt: `Ты — бренд-дизайнер и арт-директор. Разработай дизайн-концепцию бренда.

ТИП БРЕНДА: {тип_бренда}
ОТРАСЛЬ: {отрасль}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
КОНКУРЕНТНЫЕ ПРЕИМУЩЕСТВА: {преимущества}

ЭЛЕМЕНТЫ БРЕНДБУКА:

1. ЛОГОТИП И СИМВОЛИКА
   - Концепция логотипа
   - Варианты исполнения
   - Правила использования
   - Защитные зоны

2. ЦВЕТОВАЯ ПАЛИТРА
   - Основные цвета бренда
   - Акцентные цвета
   - Дополнительные цвета
   - Цветовые сочетания

3. ТИПОГРАФИКА
   - Основной шрифт
   - Акцидентный шрифт
   - Вспомогательные шрифты
   - Правила сочетания

4. ГРАФИЧЕСКИЕ ЭЛЕМЕНТЫ
   - Паттерны и орнаменты
   - Иконки и пиктограммы
   - Фотостиль
   - Графические метафоры

5. ПРИМЕНЕНИЕ В МАТЕРИАЛАХ
   - Бизнес-папка и визитки
   - Упаковка и POS-материалы
   - Цифровые носители
   - Рекламные материалы

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный брендбук с описаниями и примерами использования.`,
        tags: "брендинг,дизайн,логотип,стиль"
      }
    ]
  },

  'education': {
    templates: [
      {
        title: "Учебный курс по теме {тема} для уровня {уровень}",
        description: "Создает структуру учебного курса с модулями, уроками и практическими заданиями.",
        prompt: `Ты — методист и преподаватель. Разработай учебный курс.

ТЕМАТИКА КУРСА: {тема}
УРОВЕНЬ СЛУШАТЕЛЕЙ: {уровень}
ПРОДОЛЖИТЕЛЬНОСТЬ: {длительность} часов
ФОРМАТ: {формат}

СТРУКТУРА КУРСА:

1. ВВЕДЕНИЕ В КУРС
   - Цели и задачи обучения
   - Что получат слушатели
   - Необходимые знания
   - Формат и расписание

2. ПРОГРАММА ОБУЧЕНИЯ
   - Модуль 1: Основы ({тема})
   - Модуль 2: Продвинутые концепции
   - Модуль 3: Практическое применение
   - Модуль 4: Проектная работа

3. МЕТОДИЧЕСКИЕ МАТЕРИАЛЫ
   - Теоретические лекции
   - Практические задания
   - Кейсы и примеры
   - Тесты и проверочные работы

4. ОЦЕНКА РЕЗУЛЬТАТОВ
   - Критерии оценки
   - Формы контроля
   - Сертификат/диплом
   - Дальнейшее развитие

5. ТЕХНИЧЕСКАЯ ПОДДЕРЖКА
   - Платформа обучения
   - Материалы и ресурсы
   - Техническая поддержка
   - Сообщество учеников

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полная программа курса с детальным описанием каждого модуля.`,
        tags: "образование,курс,обучение,методика"
      }
    ]
  },

  'chat': {
    templates: [
      {
        title: "Сценарии диалогов для чат-бота {назначение}",
        description: "Создает комплексные сценарии диалогов для чат-ботов с учетом различных ситуаций и ответов.",
        prompt: `Ты — UX-дизайнер чат-ботов и сценарист диалогов. Создай сценарии для чат-бота.

НАЗНАЧЕНИЕ БОТА: {назначение}
ПЛАТФОРМА: {платформа}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ОСНОВНЫЕ ФУНКЦИИ: {функции}

ТИПЫ ДИАЛОГОВ:

1. ПРИВЕТСТВИЕ И ОНАБОАРДИНГ
   - Первое обращение
   - Представление возможностей
   - Сбор контактных данных
   - Персонализация

2. ОСНОВНЫЕ ЗАПРОСЫ
   - Информационные вопросы
   - Заказы и бронирование
   - Техническая поддержка
   - Обратная связь

3. ПРОБЛЕМНЫЕ СИТУАЦИИ
   - Недопонимание запроса
   - Агрессивные пользователи
   - Сложные технические вопросы
   - Эскалация к человеку

4. ПРОДАЮЩИЕ СЦЕНАРИИ
   - Рекомендации продуктов
   - Upselling и кросс-селлинг
   - Специальные предложения
   - Повторные продажи

5. ПРОЩАНИЕ И ЗАВЕРШЕНИЕ
   - Успешное разрешение
   - Обратная связь
   - Приглашение вернуться
   - Автоматические рассылки

СТИЛЬ ОБЩЕНИЯ: {стиль}
ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный набор диалогов с вариантами ответов.`,
        tags: "чат-бот,диалоги,сценарии,UX"
      }
    ]
  },

  'code': {
    templates: [
      {
        title: "Промпт для разработки {тип_приложения} на {технология}",
        description: "Создает детальное техническое задание для разработки программного обеспечения.",
        prompt: `Ты — технический архитектор и разработчик. Создай техническое задание.

ТИП ПРИЛОЖЕНИЯ: {тип_приложения}
ТЕХНОЛОГИЧЕСКИЙ СТЭК: {технология}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ОСНОВНЫЕ ФУНКЦИИ: {функции}

ТЕХНИЧЕСКОЕ ЗАДАНИЕ:

1. ОБЩИЕ ТРЕБОВАНИЯ
   - Назначение и цели
   - Функциональные требования
   - Нефункциональные требования
   - Ограничения и допущения

2. АРХИТЕКТУРА СИСТЕМЫ
   - Общая архитектура
   - Компоненты и модули
   - Базы данных
   - Внешние интеграции

3. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ
   - Детальное описание функций
   - Пользовательские сценарии
   - Бизнес-логика
   - Интерфейсы и API

4. ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ
   - Технологии и фреймворки
   - Производительность
   - Безопасность
   - Масштабируемость

5. ИНТЕРФЕЙС И UX
   - Структура интерфейса
   - Навигация
   - Адаптивность
   - Доступность

6. ТЕСТИРОВАНИЕ И РАЗВЕРТЫВАНИЕ
   - Стратегия тестирования
   - CI/CD пайплайн
   - Мониторинг и логирование

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полное ТЗ с диаграммами и спецификациями.`,
        tags: "разработка,ТЗ,архитектура,технологии"
      }
    ]
  },

  // Остальные категории с базовыми шаблонами
  'analysis': {
    templates: [
      {
        title: "Анализ данных {тип_данных} для {цель}",
        description: "Создает методику анализа данных с использованием статистических методов и инструментов.",
        prompt: `Ты — data scientist и аналитик. Разработай план анализа данных.

ТИП ДАННЫХ: {тип_данных}
ЦЕЛЬ АНАЛИЗА: {цель}
ОБЪЕМ ДАННЫХ: {объем}
ВРЕМЕННЫЕ ОГРАНИЧЕНИЯ: {сроки}

МЕТОДОЛОГИЯ АНАЛИЗА:

1. ПОДГОТОВКА ДАННЫХ
   - Сбор и очистка данных
   - Предварительная обработка
   - Исследовательский анализ
   - Валидация качества

2. СТАТИСТИЧЕСКИЙ АНАЛИЗ
   - Описательная статистика
   - Корреляционный анализ
   - Гипотезы и тестирование
   - Доверительные интервалы

3. МАШИННОЕ ОБУЧЕНИЕ
   - Выбор алгоритмов
   - Обучение моделей
   - Валидация и тестирование
   - Интерпретация результатов

4. ВИЗУАЛИЗАЦИЯ И ОТЧЕТНОСТЬ
   - Дашборды и графики
   - Отчеты и презентации
   - Рекомендации
   - Автоматизация отчетов

ИНСТРУМЕНТЫ: Python, R, SQL, Tableau, Power BI
ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный план анализа с методологией и инструментами.`,
        tags: "анализ,данные,статистика,машинное_обучение"
      }
    ]
  },

  'productivity': {
    templates: [
      {
        title: "Система управления задачами для команды {размер}",
        description: "Создает комплексную систему для управления задачами и повышения продуктивности команды.",
        prompt: `Ты — productivity-коуч и менеджер проектов. Создай систему управления задачами.

РАЗМЕР КОМАНДЫ: {размер}
ТИП ДЕЯТЕЛЬНОСТИ: {деятельность}
ОСНОВНЫЕ ПРОБЛЕМЫ: {проблемы}
ЦЕЛИ ПОВЫШЕНИЯ ПРОДУКТИВНОСТИ: {цели}

СИСТЕМА ПРОДУКТИВНОСТИ:

1. МЕТОДОЛОГИЯ РАБОТЫ
   - Agile/Scrum/Kanban выбор
   - Ежедневные ритуалы
   - Планирование спринтов
   - Ретроспективы

2. ИНСТРУМЕНТЫ И ПРОЦЕССЫ
   - Система управления задачами
   - Коммуникационные каналы
   - Документация и wiki
   - Автоматизация рутинных задач

3. УПРАВЛЕНИЕ ВРЕМЕНЕМ
   - Time-blocking
   - Приоритизация задач
   - Избегание прокрастинации
   - Баланс работы/отдыха

4. МОНИТОРИНГ И АНАЛИТИКА
   - KPI продуктивности
   - Отчеты о прогрессе
   - Анализ узких мест
   - Постоянное улучшение

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Готовая система управления с инструкциями и шаблонами.`,
        tags: "продуктивность,управление,задачи,команда"
      }
    ]
  },

  'research': {
    templates: [
      {
        title: "Методика исследования в области {область}",
        description: "Разрабатывает научную методику исследования с гипотезами, методами и планом анализа.",
        prompt: `Ты — научный исследователь и методолог. Создай методику исследования.

ОБЛАСТЬ ИССЛЕДОВАНИЯ: {область}
ПРОБЛЕМАТИКА: {проблема}
ЦЕЛИ ИССЛЕДОВАНИЯ: {цели}
МЕТОДОЛОГИЯ: {методология}

СТРУКТУРА ИССЛЕДОВАНИЯ:

1. ТЕОРЕТИЧЕСКАЯ БАЗА
   - Обзор литературы
   - Теоретические основы
   - Гипотезы исследования
   - Концептуальная модель

2. МЕТОДОЛОГИЯ И МЕТОДЫ
   - Дизайн исследования
   - Выборка и респонденты
   - Методы сбора данных
   - Инструменты измерения

3. ПЛАН ИССЛЕДОВАНИЯ
   - Этапы и сроки
   - Ресурсное обеспечение
   - Этические аспекты
   - Риски и ограничения

4. АНАЛИЗ ДАННЫХ
   - Количественные методы
   - Качественные методы
   - Статистическая обработка
   - Валидация результатов

5. ОФОРМЛЕНИЕ РЕЗУЛЬТАТОВ
   - Структура отчета
   - Визуализация данных
   - Интерпретация результатов
   - Практические рекомендации

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полная исследовательская методика с планом реализации.`,
        tags: "исследование,методология,наука,анализ"
      }
    ]
  },

  'image': {
    templates: [
      {
        title: "Промпт для генерации фото в стиле {стиль}",
        description: "Создает детальное описание для генерации изображений с учетом композиции, освещения и стиля.",
        prompt: `Ты — фотограф и визуальный художник. Создай описание для генерации изображения.

СТИЛЬ ФОТОГРАФИИ: {стиль}
ОСНОВНЫЙ ОБЪЕКТ: {объект}
КОНТЕКСТ И СЮЖЕТ: {контекст}
ЭМОЦИОНАЛЬНЫЙ НАСТРОЙ: {настрой}

ВИЗУАЛЬНЫЕ ПАРАМЕТРЫ:

1. КОМПОЗИЦИЯ И КАДРИРОВАНИЕ
   - Правило третей
   - Линии и направление
   - Баланс элементов
   - Фокус внимания

2. ОСВЕЩЕНИЕ И ЦВЕТ
   - Тип освещения (естественное/искусственное)
   - Цветовая температура
   - Контраст и насыщенность
   - Цветовая палитра

3. ТЕХНИЧЕСКИЕ АСПЕКТЫ
   - Угол съемки
   - Фокусное расстояние
   - Глубина резкости
   - Постобработка

4. СТИЛИСТИЧЕСКИЕ ЭЛЕМЕНТЫ
   - Фильтры и эффекты
   - Текстуры и паттерны
   - Геометрия и формы
   - Детализация

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Подробное техническое задание для генерации изображения.`,
        tags: "фото,изображения,генерация,композиция"
      }
    ]
  },

  'audio': {
    templates: [
      {
        title: "Промпт для создания подкаста о {тема}",
        description: "Разрабатывает концепцию и структуру подкаста с планом выпусков и техническими требованиями.",
        prompt: `Ты — продюсер подкастов и звукорежиссер. Создай концепцию подкаста.

ТЕМАТИКА ПОДКАСТА: {тема}
ФОРМАТ: {формат}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ЧАСТОТА ВЫПУСКОВ: {частота}

КОНЦЕПЦИЯ ПОДКАСТА:

1. ОСНОВНАЯ ИДЕЯ И КОНЦЕПЦИЯ
   - Уникальное предложение
   - Цели и миссия
   - Брендинг и оформление

2. СТРУКТУРА ВЫПУСКОВ
   - Введение и хук
   - Основной контент
   - Интерактивные элементы
   - Заключение и CTA

3. ПРОДАКШН И ТЕХНИКА
   - Оборудование для записи
   - Программы для монтажа
   - Качество звука
   - Хранение и распространение

4. ПРОДВИЖЕНИЕ И МОНЕТИЗАЦИЯ
   - Социальные сети
   - SEO для подкастов
   - Спонсорство и реклама
   - Дополнительный контент

5. АНАЛИТИКА И РАЗВИТИЕ
   - Метрики успеха
   - Обратная связь
   - Адаптация контента

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный план запуска и развития подкаста.`,
        tags: "подкаст,аудио,контент,продакшн"
      }
    ]
  },

  'photo-editing': {
    templates: [
      {
        title: "Техника ретуши портретных фотографий",
        description: "Создает подробную инструкцию по профессиональной ретуши портретов с использованием различных техник.",
        prompt: `Ты — профессиональный ретушер и фотограф. Создай инструкцию по ретуши портретов.

ТИП ПОРТРЕТА: {тип}
СТИЛЬ ОБРАБОТКИ: {стиль}
УРОВЕНЬ СЛОЖНОСТИ: {уровень}
ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ: {программа}

ПОШАГОВАЯ ИНСТРУКЦИЯ:

1. ПОДГОТОВКА ИЗОБРАЖЕНИЯ
   - Оценка качества исходника
   - Коррекция экспозиции
   - Цветокоррекция
   - Кадрирование и композиция

2. ОСНОВНАЯ РЕТУШЬ
   - Удаление дефектов кожи
   - Коррекция контуров
   - Работа с освещением
   - Улучшение текстур

3. ЦВЕТОКОРРЕКЦИЯ И СТИЛИЗАЦИЯ
   - Баланс белого
   - Контраст и насыщенность
   - Стилистические фильтры
   - Финальная цветовая гармония

4. ДОПОЛНИТЕЛЬНЫЕ ЭФФЕКТЫ
   - Виньетирование
   - Шарпенинг
   - Шумоподавление
   - Финальные штрихи

ИНСТРУМЕНТЫ И ТЕХНИКИ:
- Кисти и маски
- Слои и режимы наложения
- Интеллектуальные фильтры
- Плагины и пресеты

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Детальная инструкция с примерами и скриншотами.`,
        tags: "ретушь,фото,обработка,портрет"
      }
    ]
  },

  'photography': {
    templates: [
      {
        title: "Фотосессия {тип} в стиле {стиль}",
        description: "Создает концепцию и план проведения профессиональной фотосессии с техническими деталями.",
        prompt: `Ты — фотограф и арт-директор. Разработай концепцию фотосессии.

ТИП ФОТОСЕССИИ: {тип}
СТИЛИСТИКА: {стиль}
ЛОКАЦИЯ: {локация}
КОЛИЧЕСТВО КАДРОВ: {кадры}

КОНЦЕПЦИЯ СЪЕМКИ:

1. ТВОРЧЕСКАЯ КОНЦЕПЦИЯ
   - Основная идея
   - Эмоциональный посыл
   - Визуальная метафора
   - Цветовая палитра

2. ТЕХНИЧЕСКИЙ ПЛАН
   - Необходимое оборудование
   - Освещение и световая схема
   - Техника съемки
   - Объективы и аксессуары

3. ПОДГОТОВКА И СТИЛИНГ
   - Подготовка модели
   - Костюмы и аксессуары
   - Прическа и макияж
   - Пропы и декорации

4. ПРОЦЕСС СЪЕМКИ
   - План кадрирования
   - Последовательность съемки
   - Вариации и альтернативы
   - Контроль качества

5. ПОСТПРОДАКШН
   - Сортировка материала
   - Обработка изображений
   - Цветокоррекция
   - Финальная ретушь

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный план фотосессии с техническими спецификациями.`,
        tags: "фотосессия,фотография,съемка,концепция"
      }
    ]
  },

  'legal': {
    templates: [
      {
        title: "Шаблон договора {тип_договора} для {сфера}",
        description: "Создает шаблон юридического договора с учетом специфики сферы деятельности и требований законодательства.",
        prompt: `Ты — юрист и специалист по договорному праву. Создай шаблон договора.

ТИП ДОГОВОРА: {тип_договора}
СФЕРА ДЕЯТЕЛЬНОСТИ: {сфера}
СТОРОНЫ ДОГОВОРА: {стороны}
ОСОБЕННОСТИ РЕГУЛИРОВАНИЯ: {регулирование}

СТРУКТУРА ДОГОВОРА:

1. ПРЕАМБУЛА
   - Наименование договора
   - Дата и место заключения
   - Стороны договора
   - Определения и термины

2. ПРЕДМЕТ ДОГОВОРА
   - Обязанности сторон
   - Права и обязанности
   - Сроки исполнения
   - Территория действия

3. ФИНАНСОВЫЕ УСЛОВИЯ
   - Цена и порядок расчетов
   - Сроки оплаты
   - Штрафные санкции
   - Валюта платежа

4. ОТВЕТСТВЕННОСТЬ СТОРОН
   - Ответственность за неисполнение
   - Форс-мажорные обстоятельства
   - Порядок разрешения споров
   - Гарантии и заверения

5. ПРОЧИЕ УСЛОВИЯ
   - Срок действия договора
   - Порядок изменения
   - Конфиденциальность
   - Заключительные положения

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный текст договора с юридически корректными формулировками.`,
        tags: "договор,юриспруденция,шаблон,право"
      }
    ]
  },

  'health': {
    templates: [
      {
        title: "Программа оздоровления для {группа_пациентов}",
        description: "Создает комплексную программу медицинской реабилитации с учетом индивидуальных особенностей пациентов.",
        prompt: `Ты — врач-реабилитолог и специалист по оздоровлению. Создай программу оздоровления.

ГРУППА ПАЦИЕНТОВ: {группа}
ОСНОВНЫЕ ПРОБЛЕМЫ: {проблемы}
ПРОДОЛЖИТЕЛЬНОСТЬ ПРОГРАММЫ: {длительность}
УРОВЕНЬ ИНТЕНСИВНОСТИ: {интенсивность}

КОМПЛЕКСНАЯ ПРОГРАММА:

1. ДИАГНОСТИКА И ОЦЕНКА
   - Медицинское обследование
   - Оценка физического состояния
   - Психологическая диагностика
   - Лабораторные исследования

2. ЛЕЧЕБНАЯ ФИЗКУЛЬТУРА
   - Упражнения для позвоночника
   - Кардиотренировки
   - Силовые упражнения
   - Растяжка и гибкость

3. ДИЕТОЛОГИЧЕСКИЕ РЕКОМЕНДАЦИИ
   - Принципы питания
   - Калорийность рациона
   - Полезные продукты
   - Ограничения и запреты

4. ПСИХОЛОГИЧЕСКАЯ ПОДДЕРЖКА
   - Стресс-менеджмент
   - Мотивация и дисциплина
   - Групповые занятия
   - Индивидуальные консультации

5. МОНИТОРИНГ ПРОГРЕССА
   - Контрольные измерения
   - Коррекция программы
   - Мотивационные встречи
   - Отчеты о результатах

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Индивидуальная программа оздоровления с графиком и рекомендациями.`,
        tags: "оздоровление,медицина,реабилитация,здоровье"
      }
    ]
  },

  'finance': {
    templates: [
      {
        title: "Финансовый план для {цель} на {период}",
        description: "Создает детальный финансовый план с расчетами, рисками и стратегиями достижения финансовых целей.",
        prompt: `Ты — финансовый консультант и планировщик. Создай финансовый план.

ФИНАНСОВАЯ ЦЕЛЬ: {цель}
ВРЕМЕННОЙ ГОРИЗОНТ: {период}
НАЧАЛЬНЫЙ КАПИТАЛ: {капитал}
ЕЖЕМЕСЯЧНЫЕ ПОСТУПЛЕНИЯ: {поступления}

СТРУКТУРА ФИНАНСОВОГО ПЛАНА:

1. АНАЛИЗ ТЕКУЩЕГО ПОЛОЖЕНИЯ
   - Оценка активов и пассивов
   - Анализ доходов и расходов
   - Расчет финансовых потоков
   - Определение финансовых целей

2. ИНВЕСТИЦИОННАЯ СТРАТЕГИЯ
   - Распределение активов
   - Диверсификация портфеля
   - Стратегия накопления
   - Риски и их минимизация

3. БЮДЖЕТИРОВАНИЕ И ЭКОНОМИЯ
   - Оптимизация расходов
   - План накоплений
   - Аварийный фонд
   - Страхование рисков

4. НАЛОГОВОЕ ПЛАНИРОВАНИЕ
   - Легальные способы оптимизации
   - Отложенное налогообложение
   - Налоговые льготы
   - Планирование налоговой нагрузки

5. МОНИТОРИНГ И КОРРЕКТИРОВКА
   - Регулярный контроль
   - Коррекция стратегии
   - Адаптация к изменениям
   - Достижение целей

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Комплексный финансовый план с расчетами и рекомендациями.`,
        tags: "финансы,планирование,инвестиции,бюджет"
      }
    ]
  },

  'seo': {
    templates: [
      {
        title: "SEO-стратегия для сайта {тип_сайта}",
        description: "Разрабатывает комплексную SEO-стратегию с анализом конкурентов, ключевыми словами и планом оптимизации.",
        prompt: `Ты — SEO-специалист и маркетолог. Создай SEO-стратегию.

ТИП САЙТА: {тип_сайта}
НИША И КОНКУРЕНЦИЯ: {ниша}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
ТЕКУЩИЕ ПОЗИЦИИ: {позиции}

КОМПЛЕКСНАЯ SEO-СТРАТЕГИЯ:

1. АНАЛИЗ КОНКУРЕНТОВ И РЫНКА
   - Анализ конкурентов
   - Исследование ключевых слов
   - Анализ поискового спроса
   - Оценка SERP особенностей

2. ТЕХНИЧЕСКАЯ ОПТИМИЗАЦИЯ
   - Аудит сайта
   - Оптимизация скорости загрузки
   - Мобильная адаптация
   - Структура URL и навигация

3. КОНТЕНТ-СТРАТЕГИЯ
   - План создания контента
   - Оптимизация существующих страниц
   - Внутренняя перелинковка
   - Работа с пользовательским контентом

4. ВНЕШНЯЯ ОПТИМИЗАЦИЯ
   - Стратегия построения ссылок
   - Социальные сети и репосты
   - Партнерские материалы
   - Мониторинг упоминаний

5. АНАЛИТИКА И ОТЧЕТНОСТЬ
   - Настройка веб-аналитики
   - Метрики и KPI
   - Отчетность и корректировка
   - Прогнозирование результатов

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полная SEO-стратегия с планом действий и сроками.`,
        tags: "SEO,оптимизация,маркетинг,трафик"
      }
    ]
  },

  'animation': {
    templates: [
      {
        title: "Анимационная заставка для {проект}",
        description: "Создает концепцию анимационной заставки с техническими требованиями и стилевыми решениями.",
        prompt: `Ты — аниматор и motion-дизайнер. Создай концепцию анимационной заставки.

ТИП ПРОЕКТА: {проект}
СТИЛЬ АНИМАЦИИ: {стиль}
ДЛИТЕЛЬНОСТЬ: {длительность}
ЦЕЛЕВАЯ ПЛАТФОРМА: {платформа}

КОНЦЕПЦИЯ ЗАСТАВКИ:

1. ВИЗУАЛЬНАЯ КОНЦЕПЦИЯ
   - Общая стилистика
   - Цветовая палитра
   - Графические элементы
   - Типографика

2. НАРАТИВ И СТРУКТУРА
   - Сюжетная линия
   - Ключевые кадры
   - Эмоциональная арка
   - Брендинг элементы

3. ТЕХНИЧЕСКАЯ РЕАЛИЗАЦИЯ
   - Программное обеспечение
   - Техники анимации
   - Форматы и разрешение
   - Аудио сопровождение

4. СТИЛИСТИЧЕСКИЕ РЕШЕНИЯ
   - Типы переходов
   - Анимационные эффекты
   - Тайминг и ритм
   - Финальные штрихи

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Детальная концепция анимационной заставки с техническими спецификациями.`,
        tags: "анимация,заставка,дизайн,видео"
      }
    ]
  },

  'gaming': {
    templates: [
      {
        title: "Дизайн уровня для игры жанра {жанр}",
        description: "Создает концепцию игрового уровня с механиками, визуальным стилем и балансом сложности.",
        prompt: `Ты — геймдизайнер и разработчик игр. Создай дизайн игрового уровня.

ЖАНР ИГРЫ: {жанр}
ТИП УРОВНЯ: {тип}
ЦЕЛЕВАЯ АУДИТОРИЯ: {аудитория}
УРОВЕНЬ СЛОЖНОСТИ: {сложность}

ДИЗАЙН УРОВНЯ:

1. ОБЩАЯ КОНЦЕПЦИЯ
   - Тематика и сеттинг
   - Основная механика
   - Цели уровня
   - Уникальные особенности

2. ИГРОВЫЕ МЕХАНИКИ
   - Основные действия игрока
   - Взаимодействие с окружением
   - Система вознаграждений
   - Баланс сложности

3. ВИЗУАЛЬНЫЙ ДИЗАЙН
   - Арт-стиль и палитра
   - Архитектура уровня
   - Освещение и атмосфера
   - Детализация окружения

4. ПРОГРЕССИЯ ИГРОКА
   - Структура уровня
   - Ключевые события
   - Точки сохранения
   - Альтернативные пути

5. ТЕСТИРОВАНИЕ И БАЛАНС
   - План тестирования
   - Метрики успеха
   - Корректировка сложности
   - Пользовательский опыт

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный дизайн-документ уровня с техническими деталями.`,
        tags: "геймдизайн,уровень,механики,баланс"
      }
    ]
  },

  'cooking': {
    templates: [
      {
        title: "Рецепт блюда {тип_блюда} в стиле {кухня}",
        description: "Создает подробный кулинарный рецепт с пошаговыми инструкциями, ингредиентами и полезными советами.",
        prompt: `Ты — шеф-повар и кулинарный эксперт. Создай подробный рецепт блюда.

ТИП БЛЮДА: {тип_блюда}
КУЛИНАРНАЯ ТРАДИЦИЯ: {кухня}
УРОВЕНЬ СЛОЖНОСТИ: {сложность}
ВРЕМЯ ПРИГОТОВЛЕНИЯ: {время}

ПОЛНЫЙ РЕЦЕПТ:

1. ИНГРЕДИЕНТЫ (на {порций} порций)
   - Основные ингредиенты
   - Приправы и специи
   - Дополнительные компоненты
   - Альтернативы для замены

2. НЕОБХОДИМЫЙ ИНВЕНТАРЬ
   - Кухонная утварь
   - Техника для приготовления
   - Формы и емкости
   - Инструменты для сервировки

3. ПОШАГОВЫЙ ПРОЦЕСС ПРИГОТОВЛЕНИЯ
   - Подготовка ингредиентов
   - Основные этапы готовки
   - Техники приготовления
   - Контроль температуры и времени

4. ПОЛЕЗНЫЕ СОВЕТЫ И ХИТРОСТИ
   - Секреты приготовления
   - Возможные ошибки
   - Вариации рецепта
   - Советы по подаче

5. ПИТАТЕЛЬНАЯ ЦЕННОСТЬ
   - Калорийность на порцию
   - Белки, жиры, углеводы
   - Витамины и микроэлементы
   - Диетические особенности

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Полный кулинарный рецепт с фотографиями и советами.`,
        tags: "кулинария,рецепт,готовка,блюдо"
      }
    ]
  },

  '3d': {
    templates: [
      {
        title: "3D-модель {объект} в стиле {стиль}",
        description: "Создает техническое задание для 3D-моделирования объекта с учетом программного обеспечения и требований.",
        prompt: `Ты — 3D-моделер и CG-художник. Создай ТЗ на 3D-модель.

ТИП ОБЪЕКТА: {объект}
СТИЛИСТИКА: {стиль}
НАЗНАЧЕНИЕ МОДЕЛИ: {назначение}
УРОВЕНЬ ДЕТАЛИЗАЦИИ: {детализация}

ТЕХНИЧЕСКОЕ ЗАДАНИЕ:

1. ОБЩИЕ ТРЕБОВАНИЯ
   - Назначение и применение
   - Размер и масштаб
   - Форматы экспорта
   - Требования к качеству

2. ГЕОМЕТРИЯ И ТОПОЛОГИЯ
   - Структура полигонов
   - Количество вершин/граней
   - UV-развертка
   - Оптимизация геометрии

3. МАТЕРИАЛЫ И ТЕКСТУРЫ
   - Типы материалов
   - Разрешение текстур
   - PBR характеристики
   - Нормали и карты рельефа

4. ПРОГРАММНОЕ ОБЕСПЕЧЕНИЕ
   - Основной инструмент
   - Дополнительные плагины
   - Рендер-движок
   - Форматы обмена

5. КОНТРОЛЬ КАЧЕСТВА
   - Критерии приемки
   - Тестирование модели
   - Корректировка и доработка
   - Финальная проверка

ФИНАЛЬНЫЙ РЕЗУЛЬТАТ: Детальное ТЗ на 3D-моделирование с техническими спецификациями.`,
        tags: "3D,моделирование,графика,дизайн"
      }
    ]
  }
};

// Генерация промптов по стратегии
async function generatePromptsByStrategy() {
  console.log('🚀 НАЧИНАЕМ ГЕНЕРАЦИЮ 300 ПРОМПТОВ ПО СТРАТЕГИИ\n');

  const authorId = await getRandomAuthor();
  const results = [];
  let totalGenerated = 0;

  for (const [category, count] of Object.entries(CONTENT_STRATEGY.categories)) {
    console.log(`\n📂 ГЕНЕРАЦИЯ ДЛЯ КАТЕГОРИИ: ${category} (${count} промптов)`);

    const categoryId = await getCategoryId(category);
    const templates = promptGenerators[category]?.templates || [];

    if (templates.length === 0) {
      console.log(`⚠️  Нет шаблонов для категории ${category}, пропускаем`);
      continue;
    }

    for (let i = 0; i < count; i++) {
      const template = templates[Math.floor(Math.random() * templates.length)];

      // Выбираем модель для категории
      const model = selectModelForCategory(category);

      // Генерируем переменные для шаблона
      const variables = generateTemplateVariables(category, template);

      // Заполняем шаблон
      let promptText = template.prompt;
      let title = template.title;
      let description = template.description;
      let tags = template.tags;

      // Заменяем переменные
      Object.entries(variables).forEach(([key, value]) => {
        const regex = new RegExp(`\\{${key}\\}`, 'g');
        promptText = promptText.replace(regex, value);
        title = title.replace(regex, value);
        description = description.replace(regex, value);
        tags = tags.replace(regex, value);
      });

      // Проверяем длину промпта
      if (promptText.length < 500 || promptText.length > 1000) {
        // Корректируем длину если нужно
        if (promptText.length < 500) {
          promptText += '\n\nДОПОЛНИТЕЛЬНЫЕ РЕКОМЕНДАЦИИ:\n- Убедитесь в полноте описания\n- Добавьте конкретные примеры\n- Включите технические детали\n- Укажите возможные вариации';
        }
        if (promptText.length > 1000) {
          promptText = promptText.substring(0, 950) + '\n\n[Остальной текст сокращен для соответствия требованиям длины]';
        }
      }

      const promptData = {
        title,
        description,
        prompt: promptText,
        model,
        lang: 'Русский',
        category,
        categoryId,
        tags,
        license: 'CC-BY',
        authorId
      };

      results.push(promptData);
      totalGenerated++;

      if (totalGenerated % 50 === 0) {
        console.log(`✅ Сгенерировано ${totalGenerated}/300 промптов`);
      }
    }
  }

  console.log(`\n🎉 ГЕНЕРАЦИЯ ЗАВЕРШЕНА! Создано ${results.length} промптов`);
  return results;
}

// Генерация переменных для шаблонов
function generateTemplateVariables(category, template) {
  const variables = {};

  // Извлекаем переменные из шаблона
  const varRegex = /\{(\w+)\}/g;
  let match;
  while ((match = varRegex.exec(template.prompt + template.title + template.description)) !== null) {
    const varName = match[1];
    if (!variables[varName]) {
      variables[varName] = generateVariableValue(varName, category);
    }
  }

  return variables;
}

// Генерация значений переменных
function generateVariableValue(varName, category) {
  const generators = {
    // Marketing & Writing
    продукт: () => ['онлайн-курс по маркетингу', 'SaaS-платформа', 'мобильное приложение', 'консалтинговые услуги', 'цифровой продукт'][Math.floor(Math.random() * 5)],
    аудитория: () => ['молодые предприниматели', 'маркетологи', 'IT-специалисты', 'малый бизнес', 'фрилансеры'][Math.floor(Math.random() * 5)],
    преимущества: () => ['экономия времени', 'повышение эффективности', 'автоматизация процессов', 'масштабируемость'][Math.floor(Math.random() * 4)],
    утп: () => ['уникальная технология', 'инновационный подход', 'комплексное решение', 'персонализированный сервис'][Math.floor(Math.random() * 4)],
    ключевое_слово: () => ['маркетинг', 'продажи', 'бизнес', 'стратегия', 'развитие'][Math.floor(Math.random() * 5)],
    доп_ключи: () => ['онлайн, продажи, эффективность', 'бизнес, стратегия, рост', 'маркетинг, реклама, трафик'][Math.floor(Math.random() * 3)],
    тональность: () => ['профессиональная', 'дружелюбная', 'экспертная', 'мотивирующая'][Math.floor(Math.random() * 4)],
    цель: () => ['увеличение продаж', 'привлечение клиентов', 'повышение узнаваемости', 'строительство сообщества'][Math.floor(Math.random() * 4)],
    цена: () => ['от 5000 рублей', 'от 15000 рублей', 'от 25000 рублей', 'договорная'][Math.floor(Math.random() * 4)],
    результат: () => ['рост прибыли на 30%', 'увеличение клиентской базы', 'автоматизация рутины', 'профессиональный рост'][Math.floor(Math.random() * 4)],
    гарантии: () => ['30-дневная гарантия возврата', 'поддержка 6 месяцев', 'бесплатные обновления', 'личный консультант'][Math.floor(Math.random() * 4)],

    // Video
    тема: () => ['продуктивность', 'личный брендинг', 'стартап', 'технологии', 'здоровье'][Math.floor(Math.random() * 5)],
    платформа: () => ['YouTube', 'TikTok', 'Instagram', 'VK Video', 'RuTube'][Math.floor(Math.random() * 5)],

    // Music
    жанр: () => ['электронная', 'рок', 'джаз', 'классика', 'хип-хоп'][Math.floor(Math.random() * 5)],
    настроение: () => ['вдохновляющее', 'меланхоличное', 'энергичное', 'спокойное', 'драматичное'][Math.floor(Math.random() * 5)],
    темп: () => ['120 BPM', '90 BPM', '140 BPM', '100 BPM'][Math.floor(Math.random() * 4)],
    длительность: () => ['3-4 минуты', '2-3 минуты', '4-5 минут', '1-2 минуты'][Math.floor(Math.random() * 4)],
    инструменты: () => ['синтезатор, ударные', 'гитара, бас', 'пианино, струнные', 'электронные сэмплы'][Math.floor(Math.random() * 4)],
    эмоция: () => ['радость', 'ностальгия', 'мотивация', 'релакс', 'напряжение'][Math.floor(Math.random() * 5)],
    эффект: () => ['повышение концентрации', 'снятие стресса', 'мотивация к действию', 'создание атмосферы'][Math.floor(Math.random() * 4)],
    ассоциации: () => ['путешествия', 'успех', 'природа', 'технологии', 'искусство'][Math.floor(Math.random() * 5)],

    // Business
    отрасль: () => ['e-commerce', 'финтех', 'edtech', 'healthtech', 'маркетинг'][Math.floor(Math.random() * 5)],
    размер: () => ['стартап (5-10 человек)', 'SMB (50 человек)', 'корпорация (200+ человек)', 'масштабный бизнес'][Math.floor(Math.random() * 4)],
    продукты: () => ['SaaS-платформа', 'мобильное приложение', 'онлайн-курсы', 'консалтинг'][Math.floor(Math.random() * 4)],
    капитал: () => ['500 тыс. рублей', '2 млн рублей', '10 млн рублей', '50 млн рублей'][Math.floor(Math.random() * 4)],

    // Creative
    стиль: () => ['минимализм', 'винтаж', 'хай-тек', 'этно', 'футуризм'][Math.floor(Math.random() * 5)],
    тематика: () => ['экология', 'технологии', 'искусство', 'путешествия', 'здоровье'][Math.floor(Math.random() * 5)],

    // Design
    тип_бренда: () => ['технологическая компания', 'ресторан', 'клиника', 'образовательный центр', 'магазин'][Math.floor(Math.random() * 5)],

    // Education
    уровень: () => ['начинающий', 'средний', 'продвинутый', 'эксперт'][Math.floor(Math.random() * 4)],

    // Chat
    назначение: () => ['техническая поддержка', 'продажи', 'консультации', 'онбординг'][Math.floor(Math.random() * 4)],

    // Code
    тип_приложения: () => ['веб-приложение', 'мобильное приложение', 'API', 'система управления'][Math.floor(Math.random() * 4)],
    технология: () => ['React + Node.js', 'Vue.js + Python', 'Angular + Java', 'Next.js + TypeScript'][Math.floor(Math.random() * 4)],

    // Analysis
    тип_данных: () => ['продажи', 'пользовательское поведение', 'финансовые показатели', 'маркетинговые метрики'][Math.floor(Math.random() * 4)],
    цель: () => ['оптимизация конверсии', 'прогноз продаж', 'сегментация клиентов', 'оценка эффективности'][Math.floor(Math.random() * 4)],

    // Productivity
    деятельность: () => ['разработка ПО', 'маркетинг', 'дизайн', 'управление проектами'][Math.floor(Math.random() * 4)],
    проблемы: () => ['низкая эффективность', 'прокрастинация', 'отсутствие приоритетов', 'плохая коммуникация'][Math.floor(Math.random() * 4)],

    // Research
    область: () => ['психология', 'экономика', 'технологии', 'социология', 'маркетинг'][Math.floor(Math.random() * 5)],
    проблема: () => ['мотивация персонала', 'поведение потребителей', 'эффективность обучения', 'цифровая трансформация'][Math.floor(Math.random() * 4)],
    цели: () => ['выявление закономерностей', 'разработка рекомендаций', 'проверка гипотез', 'оценка эффективности'][Math.floor(Math.random() * 4)],
    методология: () => ['количественная', 'качественная', 'смешанная', 'экспериментальная'][Math.floor(Math.random() * 4)],

    // Image
    объект: () => ['портрет человека', 'городской пейзаж', 'натюрморт', 'абстрактная композиция'][Math.floor(Math.random() * 4)],
    контекст: () => ['профессиональная фотосессия', 'художественный проект', 'коммерческая реклама', 'личный архив'][Math.floor(Math.random() * 4)],

    // Audio
    формат: () => ['интервью', 'лекция', 'обзор', 'история'][Math.floor(Math.random() * 4)],
    частота: () => ['еженедельно', 'два раза в неделю', 'ежемесячно', 'по мере готовности'][Math.floor(Math.random() * 4)],

    // Photo Editing
    тип: () => ['портрет', 'семейная фотосессия', 'предметная съемка', 'архитектура'][Math.floor(Math.random() * 4)],
    программа: () => ['Photoshop', 'Lightroom', 'GIMP', 'Capture One'][Math.floor(Math.random() * 4)],

    // Photography
    тип: () => ['портретная', 'семейная', 'предметная', 'архитектурная'][Math.floor(Math.random() * 4)],
    локация: () => ['студия', 'улица города', 'природа', 'интерьер'][Math.floor(Math.random() * 4)],
    кадры: () => ['20-30', '30-50', '50-100', '100+'][Math.floor(Math.random() * 4)],

    // Legal
    тип_договора: () => ['оказания услуг', 'поставки', 'подряда', 'аренды'][Math.floor(Math.random() * 4)],
    сфера: () => ['IT', 'маркетинг', 'производство', 'торговля'][Math.floor(Math.random() * 4)],
    стороны: () => ['компания и фрилансер', 'две компании', 'компания и ИП', 'физические лица'][Math.floor(Math.random() * 4)],
    регулирование: () => ['Гражданский кодекс РФ', 'ФЗ-152', 'ФЗ-149', 'международное право'][Math.floor(Math.random() * 4)],

    // Health
    группа: () => ['офисные работники', 'спортсмены', 'пожилые люди', 'беременные женщины'][Math.floor(Math.random() * 4)],
    интенсивность: () => ['легкая', 'средняя', 'высокая', 'индивидуальная'][Math.floor(Math.random() * 4)],

    // Finance
    период: () => ['1 год', '3 года', '5 лет', '10 лет'][Math.floor(Math.random() * 4)],
    поступления: () => ['50 000 руб/мес', '100 000 руб/мес', '200 000 руб/мес', 'переменные'][Math.floor(Math.random() * 4)],

    // SEO
    тип_сайта: () => ['интернет-магазин', 'блог', 'корпоративный сайт', 'лендинг'][Math.floor(Math.random() * 4)],
    ниша: () => ['высококонкурентная', 'средней конкуренции', 'нишевая', 'новая'][Math.floor(Math.random() * 4)],
    позиции: () => ['ТОП-10', 'ТОП-30', 'ТОП-100', 'не ранжируется'][Math.floor(Math.random() * 4)],

    // Animation
    проект: () => ['корпоративный ролик', 'рекламная заставка', 'обучающее видео', 'презентация'][Math.floor(Math.random() * 4)],

    // Gaming
    жанр: () => ['экшн', 'RPG', 'стратегия', 'пазл'][Math.floor(Math.random() * 4)],
    тип: () => ['обучающий', 'основной', 'бонусный', 'финальный'][Math.floor(Math.random() * 4)],

    // Cooking
    тип_блюда: () => ['основное', 'закуска', 'десерт', 'салат'][Math.floor(Math.random() * 4)],
    кухня: () => ['итальянская', 'азиатская', 'русская', 'средиземноморская'][Math.floor(Math.random() * 4)],
    порций: () => ['2', '4', '6', '8'][Math.floor(Math.random() * 4)],

    // 3D
    объект: () => ['мебель', 'техника', 'персонаж', 'архитектура'][Math.floor(Math.random() * 4)],
    назначение: () => ['визуализация', 'игра', 'печать', 'анимация'][Math.floor(Math.random() * 4)],
    детализация: () => ['низкая', 'средняя', 'высокая', 'ультра'][Math.floor(Math.random() * 4)]
  };

  return generators[varName] ? generators[varName]() : varName;
}

// Основная функция генерации и сохранения
async function generateAndSavePrompts() {
  try {
    const prompts = await generatePromptsByStrategy();

    console.log('\n💾 НАЧИНАЕМ СОХРАНЕНИЕ ПРОМПТОВ В БАЗУ ДАННЫХ...\n');

    let savedCount = 0;
    const batchSize = 10; // Сохраняем по 10 промптов за раз

    for (let i = 0; i < prompts.length; i += batchSize) {
      const batch = prompts.slice(i, i + batchSize);

      await prisma.$transaction(async (tx) => {
        for (const promptData of batch) {
          // Проверяем уникальность заголовка для автора
          const existingPrompt = await tx.prompt.findUnique({
            where: {
              title_authorId: {
                title: promptData.title,
                authorId: promptData.authorId
              }
            }
          });

          if (!existingPrompt) {
            await tx.prompt.create({
              data: promptData
            });
            savedCount++;
          } else {
            console.log(`⚠️  Промпт "${promptData.title}" уже существует, пропускаем`);
          }
          const newVariables = generateTemplateVariables(category, template);

          let newTitle = template.title;
          let newPrompt = template.prompt;
          let newDescription = template.description;
          let newTags = template.tags;

          Object.entries(newVariables).forEach(([key, value]) => {
            const regex = new RegExp(`\\{${key}\\}`, 'g');
            newTitle = newTitle.replace(regex, value);
            newPrompt = newPrompt.replace(regex, value);
            newDescription = newDescription.replace(regex, value);
            newTags = newTags.replace(regex, value);
          });

          // Проверяем длину
          if (newPrompt.length < 500 || newPrompt.length > 1000) {
            if (newPrompt.length < 500) {
              newPrompt += '\n\nДОПОЛНИТЕЛЬНЫЕ РЕКОМЕНДАЦИИ:\n- Убедитесь в полноте описания\n- Добавьте конкретные примеры\n- Включите технические детали\n- Укажите возможные вариации';
            }
            if (newPrompt.length > 1000) {
              newPrompt = newPrompt.substring(0, 950) + '\n\n[Остальной текст сокращен для соответствия требованиям длины]';
            }
          }

          finalPromptData = {
            title: newTitle,
            description: newDescription,
            prompt: newPrompt,
            model,
            lang: 'Русский',
            category,
            categoryId,
            tags: newTags,
            license: 'CC-BY',
            authorId
          };
        }
      });

      console.log(`✅ Сохранено ${savedCount}/${prompts.length} промптов`);

      // Небольшая пауза между батчами
      await new Promise(resolve => setTimeout(resolve, 100));
    }

    console.log('\n🎉 ГЕНЕРАЦИЯ И СОХРАНЕНИЕ ЗАВЕРШЕНЫ!');
    console.log(`📊 Итого создано: ${savedCount} новых промптов`);

    // Финальная проверка
    const finalCount = await prisma.prompt.count();
    console.log(`📈 Общее количество промптов в базе: ${finalCount}`);

  } catch (error) {
    console.error('❌ ОШИБКА ГЕНЕРАЦИИ ПРОМПТОВ:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

// Экспорт для использования
module.exports = { generateAndSavePrompts };

if (require.main === module) {
  generateAndSavePrompts();
}
