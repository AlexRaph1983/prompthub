# üîç API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

## üìã –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π, –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### **1. –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π:**
- ‚úÖ **–¢–æ–ª—å–∫–æ –ø–æ Enter –∏–ª–∏ blur** - —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤–≤–æ–¥–∞
- ‚úÖ **Debounce 600ms** - –ø–æ–¥—Å–∫–∞–∑–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –Ω–æ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ **–§–ª–∞–≥ finished=true** - –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### **2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è:**
- ‚úÖ **–£–¥–∞–ª–µ–Ω–∏–µ emoji** - –≤—Å–µ emoji —Å–∏–º–≤–æ–ª—ã —É–¥–∞–ª—è—é—Ç—Å—è
- ‚úÖ **–°–∂–∞—Ç–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤** - –º–∞–∫—Å–∏–º—É–º 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–∞ –ø–æ–¥—Ä—è–¥
- ‚úÖ **–ú–∏–Ω–∏–º—É–º 2 –±—É–∫–≤—ã** - –∑–∞–ø—Ä–æ—Å—ã —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±—É–∫–≤ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
- ‚úÖ **–°—Ç–æ–ø-—Å–ª–æ–≤–∞** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞

## üîß API Endpoints

### **POST /api/search-tracking**

–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

#### **Request Body:**
```json
{
  "query": "string",           // –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
  "resultsCount": "number", // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  "clickedResult": "string",   // ID –∫–ª–∏–∫–Ω—É—Ç–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  "sessionId": "string",       // ID —Å–µ—Å—Å–∏–∏
  "finished": "boolean"        // –§–ª–∞–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ true)
}
```

#### **Response (Success):**
```json
{
  "success": true,
  "processed": "string",       // –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
  "hash": "string",           // –•—ç—à –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
  "metrics": {                 // –ú–µ—Ç—Ä–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    "length": "number",
    "percentLetters": "number",
    "maxConsecutiveChars": "number",
    "hasOnlyNumbers": "boolean",
    "hasOnlySpecialChars": "boolean"
  }
}
```

#### **Response (Error):**
```json
{
  "error": "string",           // –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
  "reason": "string",          // –ö–æ–¥ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
  "metrics": {                 // –ú–µ—Ç—Ä–∏–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    "length": "number",
    "percentLetters": "number",
    "maxConsecutiveChars": "number",
    "hasOnlyNumbers": "boolean",
    "hasOnlySpecialChars": "boolean"
  }
}
```

### **GET /api/admin/search-metrics**

–ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞.

#### **Query Parameters:**
- `includeStats` (boolean) - –≤–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

#### **Response:**
```json
{
  "success": true,
  "data": {
    "metrics": {
      "countSaved": "number",      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      "countRejected": "number",   // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      "totalQueries": "number",    // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
      "acceptanceRate": "number",  // –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      "rejectionRate": "number",   // –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
      "lastUpdated": "string"      // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    },
    "rejectionReasons": {          // –ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
      "TOO_SHORT": "number",
      "INSUFFICIENT_LETTERS": "number",
      "STOP_WORD": "number"
    },
    "rejectionStats": [            // –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–µ—Å–ª–∏ includeStats=true)
      {
        "reason": "string",
        "count": "number",
        "percentage": "number",
        "description": "string"
      }
    ]
  }
}
```

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### **useAdminSearch Hook**

–•—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∏—Å–∫–æ–º –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

#### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```typescript
interface AdminSearchOptions {
  debounceMs?: number                    // Debounce –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 600)
  onSearch?: (query: string, finished: boolean) => void    // –ö–æ–ª–±—ç–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞
  onSuggestions?: (query: string) => void                 // –ö–æ–ª–±—ç–∫ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
}
```

#### **–í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
```typescript
{
  searchValue: string,                   // –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
  setSearchValue: (value: string) => void, // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
  isSearching: boolean,                  // –§–ª–∞–≥ –ø–æ–∏—Å–∫–∞
  handleKeyDown: (e: KeyboardEvent) => void, // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π –∫–ª–∞–≤–∏—à
  handleBlur: () => void,                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞
  clearSearch: () => void,              // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
  cleanup: () => void                   // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
}
```

### **AdminPromptManagement Component**

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞–º–∏ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º.

#### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `useAdminSearch` —Ö—É–∫–æ–º
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

## üîç –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

### **–§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**

#### **stripEmojis(text: string): string**
–£–¥–∞–ª—è–µ—Ç –≤—Å–µ emoji —Å–∏–º–≤–æ–ª—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞.

#### **collapseRepeatedChars(text: string): string**
–°–∂–∏–º–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–∏–º–≤–æ–ª—ã –¥–æ –º–∞–∫—Å–∏–º—É–º 2 –ø–æ–¥—Ä—è–¥.

#### **countLetters(text: string): number**
–ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤ –≤ —Ç–µ–∫—Å—Ç–µ.

#### **isStopWord(text: string): boolean**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç —Å—Ç–æ–ø-—Å–ª–æ–≤–æ–º.

#### **hasMinLetters(text: string, minLetters: number): boolean**
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—É–∫–≤.

#### **filterSearchQuery(query: string): FilterResult**
–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.

### **–°—Ç–æ–ø-—Å–ª–æ–≤–∞:**
```typescript
const STOP_WORDS = [
  'spam', 'test', '—Ç–µ—Å—Ç', '—Ñ–æ–Ω', '—Ñ—É–Ω–∫', '–ø—Ä–æ–≤–µ—Ä', '–ø—Ä–æ–≤–µ—Ä–∫–∞', '–ø—Ä–æ–≤–µ—Ä—è—é',
  '–∞', '–±', '–≤', '–≥', '–¥', '–µ', '—ë', '–∂', '–∑', '–∏', '–π', '–∫', '–ª', '–º', '–Ω', '–æ', '–ø', '—Ä', '—Å', '—Ç', '—É', '—Ñ', '—Ö', '—Ü', '—á', '—à', '—â', '—ä', '—ã', '—å', '—ç', '—é', '—è',
  'the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by'
]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **Unit —Ç–µ—Å—Ç—ã:**
```bash
npm test -- --testPathPattern="useAdminSearch|search-filtering"
```

### **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ Debounce –ª–æ–≥–∏–∫–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ç–æ–ª—å–∫–æ –ø–æ Enter/blur
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–æ–ø-—Å–ª–æ–≤
- ‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- `countSaved` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `countRejected` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `acceptanceRate` - –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–∏–Ω—è—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `rejectionRate` - –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### **–ü—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:**
- `EMPTY_QUERY` - –ø—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
- `STOP_WORD` - –∑–∞–ø—Ä–æ—Å –≤ —Å—Ç–æ–ø-–ª–∏—Å—Ç–µ
- `INSUFFICIENT_LETTERS` - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—É–∫–≤
- `EMPTY_AFTER_FILTERING` - –ø—É—Å—Ç–æ–π –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### **–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
const {
  searchValue,
  setSearchValue,
  isSearching,
  handleKeyDown,
  handleBlur,
  clearSearch
} = useAdminSearch({
  onSearch: (query, finished) => {
    if (finished) {
      // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫
      performSearch(query)
    }
  },
  onSuggestions: (query) => {
    // –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
    updateSuggestions(query)
  }
})
```

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**
```tsx
<input
  type="text"
  value={searchValue}
  onChange={(e) => setSearchValue(e.target.value)}
  onKeyDown={handleKeyDown}
  onBlur={handleBlur}
  placeholder="–ü–æ–∏—Å–∫..."
/>
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### **Debounce –≤—Ä–µ–º—è:**
```typescript
const { ... } = useAdminSearch({
  debounceMs: 600 // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ debounce
})
```

### **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–ª–±—ç–∫–∏:**
```typescript
const { ... } = useAdminSearch({
  onSearch: (query, finished) => {
    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞
  },
  onSuggestions: (query) => {
    // –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
  }
})
```
